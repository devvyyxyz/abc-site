<div id="modpacks-list" class="modpacks-list"></div>

<script>
  // Featured projects pulled from the cached Modrinth feed
  document.addEventListener('DOMContentLoaded', async () => {
    const container = document.getElementById('modpacks-list');
    if (!container) return;

    try {
      const res = await fetch('{{ '/data/mods.json' | relative_url }}');
      if (!res.ok) throw new Error(`HTTP ${res.status}: Failed to load projects`);

      const projects = await res.json();
      if (!Array.isArray(projects) || projects.length === 0) {
        container.innerHTML = '<div class="card"><p class="muted">No projects found. They will sync automatically.</p></div>';
        return;
      }

      // Take the first few items to showcase on the homepage
      renderFeatured(projects.slice(0, 3));
    } catch (e) {
      console.error('Failed to load featured projects:', e);
      container.innerHTML = `<div class="card"><p class="muted">Error loading projects: ${e.message}</p></div>`;
    }

    function formatDate(value) {
      if (!value) return 'Unknown';
      const d = new Date(value);
      if (Number.isNaN(d.getTime())) return 'Unknown';
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function renderFeatured(items) {
      container.innerHTML = '';
      items.forEach((m, i) => {
        const el = document.createElement('div');
        el.className = 'modpack';
        el.style.animationDelay = (i * 70) + 'ms';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.style.backgroundImage = `url(${m.icon_url || m.thumbnail || '/assets/images/favicon.svg'})`;

        const meta = document.createElement('div');
        meta.className = 'meta';
        const shortDesc = m.short_description || m.summary || m.description || '';
        const desc = shortDesc.length > 140 ? `${shortDesc.substring(0, 140)}...` : shortDesc;
        const tags = (m.display_categories || m.categories || []).slice(0, 4);
        const versions = (m.game_versions || []).slice(-2).reverse();
        const loaders = (m.loaders || []).slice(0, 2);

        const pill = (label, icon) => `<span class="pill">${icon ? `<i class="fa-solid fa-${icon}"></i>` : ''}${label}</span>`;
        const metaInfo = [
          m.updated || m.published ? pill(`Updated ${formatDate(m.updated || m.published)}`, 'clock') : '',
          versions.length ? pill(`MC ${versions.join(', ')}`, 'cube') : '',
          loaders.length ? pill(`Loaders: ${loaders.join(', ')}`, 'cogs') : ''
        ].filter(Boolean).join('');

        meta.innerHTML = `
          <h3>${m.title || m.name}</h3>
          <p>${desc}</p>
          <div class="meta-info">${metaInfo}</div>
          <div class="tags">${tags.map(c => `<span class="pill">#${c}</span>`).join(' ')}</div>
        `;

        const action = document.createElement('div');
        action.className = 'actions';
        action.innerHTML = `<a class="btn primary" href="${m.download || `https://modrinth.com/mod/${m.slug || ''}`}" target="_blank" rel="noopener">View</a>`;

        el.appendChild(thumb);
        el.appendChild(meta);
        el.appendChild(action);
        container.appendChild(el);
      });
    }
  });
</script>
