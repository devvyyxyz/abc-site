<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title | default: site.title }}</title>
    <meta
      name="description"
      content="{{ page.description | default: site.description }}"
    />

    <!-- SEO Meta Tags -->
    {% assign meta_config = site.meta | default: site.branding.meta %} {% assign
    default_embed_image = meta_config.embeds.default.image | default:
    meta_config.og_image | default: site.site.logo %} {% assign
    discord_embed_image = meta_config.embeds.discord.image | default:
    default_embed_image %} {% assign twitter_embed_image =
    meta_config.embeds.twitter.image | default: default_embed_image %} {% assign
    embed_image = page.og_image | default: page.icon_url | default:
    discord_embed_image %} {% assign embed_alt = page.og_image_alt | default:
    meta_config.embeds.default.alt | default: site.site.name %} {% assign
    twitter_card = meta_config.embeds.twitter.card | default:
    'summary_large_image' %}

    <meta
      property="og:title"
      content="{{ page.title | default: site.title }}"
    />
    <meta
      property="og:description"
      content="{{ page.description | default: site.description }}"
    />
    <meta property="og:url" content="{{ page.url | absolute_url }}" />
    <meta property="og:image" content="{{ embed_image | absolute_url }}" />
    <meta property="og:image:alt" content="{{ embed_alt }}" />
    <meta property="og:type" content="{{ page.layout | default: 'website' }}" />
    <meta property="og:site_name" content="{{ site.site.name }}" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="{{ twitter_card }}" />
    <meta
      name="twitter:title"
      content="{{ page.title | default: site.title }}"
    />
    <meta
      name="twitter:description"
      content="{{ page.description | default: site.description }}"
    />
    <meta
      name="twitter:image"
      content="{{ page.twitter_image | default: twitter_embed_image | absolute_url }}"
    />
    <meta name="twitter:image:alt" content="{{ embed_alt }}" />
    <meta
      name="twitter:creator"
      content="{{ site.social.twitter | replace: 'https://twitter.com/', '@' }}"
    />

    <meta
      name="theme-color"
      content="{{ site.branding.accent | default: site.site.color }}"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ meta_config.favicon | default: '/assets/images/favicon.svg' | relative_url }}"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ meta_config.favicon | default: '/favicon.ico' | relative_url }}"
    />
    <link
      rel="apple-touch-icon"
      href="{{ meta_config.apple_touch_icon | default: meta_config.og_image | relative_url }}"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ '/assets/css/root.css' | relative_url }}" />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/layout.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/components.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/modpacks.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/loading.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/animations.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/theme.css' | relative_url }}"
    />
    <link rel="stylesheet" href="{{ '/assets/css/a11y.css' | relative_url }}" />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/visual-enhancements.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/mobile.css' | relative_url }}"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}" />

    <!-- Schema Markup -->
    {% include schema-markup.html %}

    <!-- Preloader Script (critical, inline) -->
    <script>
      (function () {
        if (!document.body) return; // Exit if body not ready yet

        const isDarkMode =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const bgColor = isDarkMode ? "#0d0d0d" : "#f6fbfa";
        document.documentElement.style.backgroundColor = bgColor;
        document.body.style.backgroundColor = bgColor;

        const overlay = document.createElement("div");
        overlay.className = "loading-overlay";
        overlay.id = "loading-overlay";
        overlay.innerHTML = '<div class="spinner"></div>';
        document.body.appendChild(overlay);

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", hidePreloader);
        } else {
          hidePreloader();
        }

        function hidePreloader() {
          const preloader = document.getElementById("loading-overlay");
          if (preloader) {
            preloader.classList.add("hidden");
          }
        }

        window.hidePreloader = hidePreloader;
      })();
    </script>
  </head>
  <body>
    <a href="#main" class="skip-to-main">Skip to main content</a>
    {% include nav.html %}

    <main id="main" class="container">{{ content }}</main>

    {% include footer.html %} {% include enhancements.html %}

    <!-- Scripts -->
    <script src="{{ '/assets/js/search.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/performance.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/visual-enhancements.js' | relative_url }}"></script>
  </body>
</html>
